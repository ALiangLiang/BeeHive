<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="http://www.im.ntu.edu.tw/~b102020/imyourangel/css/bootstrap.min.css" type="text/css" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="https://raw.githubusercontent.com/mholt/jquery.parse/master/jquery.parse.min.js"></script>
</head>
<body>
<div class="masthead">
<h3 class="muted">BeeTalk Map Demo</h3>
</div>
<div class="row-fluid" style="text-align: center">
	<div id="map" style="width:800px; height: 400px; margin: 0 auto"></div>
  <div class="span12" id="chat_content"></div>

<input class="span2" id="username" placeholder="發言暱稱" size="20" type="text"><br>
<input class="span2" id="plat" placeholder="緯度" size="300" type="text"><br>
<input class="span2" id="plong" placeholder="經度" size="300" type="text"><br>
<input class="span2" id="comment" placeholder="留言" size="300" type="text"><br>
		<button class="btn" type="button" id="send">Send!</button>

</div>
<script>

function timeConverter(UNIX_timestamp){
 var a = new Date(UNIX_timestamp*1000);
 var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
     var year = a.getFullYear();
     var month = months[a.getMonth()];
     var date = a.getDate();
     var hour = a.getHours();
     var min = a.getMinutes();
     var sec = a.getSeconds();
     var time = date+','+month+' '+year+' '+hour+':'+min+':'+sec ;
     return time;
 }

// create a map in the "map" div, set the view to a given place and zoom
var map = L.map('map').setView([25.0263075,121.543846], 15);

// add an OpenStreetMap tile layer
L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
		attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

// add a marker in the given location, attach some popup content to it and open the popup
L.marker([25.0263075,121.543846]).addTo(map)
		.bindPopup('請點選地圖上想要標記的點，然後填寫資料送出，其他人就可以及時看到喔～～～')
		.openPopup();

$.ajax("output.csv")
  .done(function( data ) {
		var results = $.parse(data, {
    header: false,
    dynamicTyping: false,
    preview: 10,
    step: function(data, file, inputElem) {
        data.results.forEach(function(data){
					// gender: 0 boy 1 girl
//["", "3470597", "19971019", "愛你的那一個.傷你的那一個", "WhatismyID", "張佳祺", "0", "7489495354551109000", "0", "0", "1", "0", "1403085280", "0", "1400084015", "24.988679885864258", "121.5671157836914", "1403074823", "3470597"]
					data[5]
					var color = 'cornflowerblue';
					if(data[6] == 1){
						color = 'hotpink';
					}
//12 time
					var marker = new L.marker([data[15],data[16]]).addTo(map)
					.bindPopup('<span style="color:' + color + '">' + data[5] + '</span> ' + data[2] + '<br>' + data[4] + '<br>' + data[3] + '<br><br>' + timeConverter(data[12]))
					.openPopup();;

					console.log(data);
				});
    }
		});
  });



</script>
</body>
</html>

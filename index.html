<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="http://www.im.ntu.edu.tw/~b102020/imyourangel/css/bootstrap.min.css" type="text/css" />
<link rel="stylesheet" href="./awesome-markers/leaflet.awesome-markers.css" type="text/css" />
<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.0/jquery.min.js"></script>
<script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
<script src="./awesome-markers/leaflet.awesome-markers.min.js"></script>
<script src="./jquery.parse.min.js"></script>
</head>
<body>
<div class="masthead" style="margin-left: 30px">
<h3 class="muted">BeeTalk Map Demo</h3>
</div>
<div class="row-fluid" style="text-align: center">
	<div id="map" style="width:1000px; height: 700px; margin: 0 auto"></div>
</div>
<script>

function timeConverter(UNIX_timestamp){
 var a = new Date(UNIX_timestamp*1000);
 var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
     var year = a.getFullYear();
     var month = months[a.getMonth()];
     var date = a.getDate();
     var hour = a.getHours();
     var min = a.getMinutes();
     var sec = a.getSeconds();
     var time = date+','+month+' '+year+' '+hour+':'+min+':'+sec ;
     return time;
 }

// create a map in the "map" div, set the view to a given place and zoom
var map = L.map('map').setView([25.0192013,121.5407913], 16);

// add an OpenStreetMap tile layer
L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
		attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
}).addTo(map);

// add a marker in the given location, attach some popup content to it and open the popup
/*
L.marker([25.0263075,121.543846]).addTo(map)
		.bindPopup('請點選地圖上想要標記的點，然後填寫資料送出，其他人就可以及時看到喔～～～')
		.openPopup();
*/

$.ajax("data.csv")
  .done(function( data ) {
		var results = $.parse(data, {
    header: false,
    dynamicTyping: false,
    preview: 350,
    step: function(data, file, inputElem) {
        data.results.forEach(function(data){
					// gender: 0 boy 1 girl
					var text_color = ['cornflowerblue','hotpink'];
					var icons = ['male', 'female'];
					var marker_color = ['blue','red'];
//12 time
					var marker = new L.marker([data[15],data[16]], {icon: L.AwesomeMarkers.icon({icon: icons[data[6]], prefix: 'fa', markerColor: marker_color[data[6]]}) }).addTo(map)
					.bindPopup('<img src="avatar/' + data[7] + '">Name: <span style="color:' + text_color[data[6]] + '">' + data[5] + '</span><br>Birthday: ' + data[2] + '<br>BeeTalk ID: ' + data[4] + '<br>Status: ' + data[3] + '<br><br>Last Update: ' + timeConverter(data[12]))
					.openPopup();;

					console.log(data);
				});
    }
		});
  });



</script>
</body>
</html>
